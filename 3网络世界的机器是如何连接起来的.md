---
typora-root-url: pic
---



所有的故事从一张图开始

![](/机器之间是怎么连接的.png)



交换机是什么？

二层交换机

- 作用于第二层，它会把发送者的数据包中的数据链路层的头取下来得到目标MAC地址，然后找到MAC地址对应的机器端口，将网络包转发。

三层交换机

- 基于二层交换机的功能，三层交换机还能把发送者的数据包中网络层的头取下来，找到目标IP地址对应的出口，将网络包转发

  

网桥、网关、路由器？

- 网桥是一个二层交换机
- 跨网段的网络通信，需要一个三层交换机。这个三层交换机就叫网关
- 网关往往由路由器充当，路由器是一个三层交换机，并且能连接多个网段



网段、局域网、VLAN？

 - 网段
   - 就是二层交换机可达的机器，就组成了一个网段。这些机器的ip使用了同一个子网掩码。网络的网络就是子网。
 - 局域网
   - 我查到的局域网概念都是围绕着使用范围和传输介质在解释，但是在程序员这个角度来看，更关心的是局域网与网段的关系。
   - 从交换机的概念可以得知，只有二层交换机的不会有多个网段，有三层交换机的局域网可以有多个网段。

- VLAN
  - 一台机器向外发出广播，二层交换机可达的设备都在广播范围内。有场景下，为了安全，不需要广播到这么多机器，只广播到自己所属的区域内就行。
  - 一种做法是一个区域内的机器使用一个二层交换机连接，不同区域使用三层交换机连接。
  - 有更简单的方式：VLAN
    - 广播范围内的所有的机器依然采用二层交换机连接（可能是多个）
    - 每个区域使用一个VLAN ID
    - 广播包中二层头加上一个VLAN ID标识
    - 交换机只会给匹配的VLAN ID转发广播包



